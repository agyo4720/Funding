<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
	<title>fundBoard_form</title>
	
	<!-- BootStrap / summernote -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">

	<style>
		/* 에러메세지 */
		.errors{
			color: red;
    		display: none;
    	}
        
	</style>
</head>
<body>

	<div id="warp">

		<div class="header">
			<h2>펀딩 작성</h2>
		</div>	
		<div class="main">

			<form th:object="${fundBoardForm}" method="POST">
				<div>
					<label for="categorieName">카테고리</label>
					<select id="categorieName" th:field="*{categorieName}">
						<option value="">카테고리 선택</option>
						<option th:each="categorie : ${categorieList}" th:text="${categorie.categorieName}" th:value="${categorie.categorieName}"></option>
					</select>
					<span class="errors" style="display: none">에러출력</span>
				</div>
				<div>
					<label for="subject">제목</label>
					<input type="text" id="subject" th:field="*{subject}">
					<span class="errors" style="display: none">에러출력</span>
				</div>
				<div>
					<label for="place">장소</label>
					<input type="text" id="place" th:field="*{place}">
					<span class="errors" style="display: none">에러출력</span>
				</div>
				<div>
					<label for="startDateTime">공연 시작 일자</label>
					<input type="datetime-local" id="startDateTime" th:field="*{startDateTime}">
					<span class="errors" style="display: none">에러출력</span>
				</div>
				<div>
					<label for="fundDuration">펀딩 기간</label>
					<input type="date" id="fundDuration" th:field="*{fundDuration}" th:min="${nowTime}">
					<span class="errors" style="display: none">에러출력</span>
				</div>
				<div>
					<label for="runtime">공연 시간</label>
					<input type="number" id="runtime" th:field="*{runtime}">
					<span class="errors" style="display: none">에러출력</span>
				</div>
				<div>
					<label for="minFund">1인 최소 펀딩 금액</label>
					<input type="number" id="minFund" th:field="*{minFund}">
					<span class="errors" style="display: none">에러출력</span>
				</div>
				<div>
					<label for="fundAmount">펀딩 목표 금액</label>
					<input type="number" id="fundAmount" th:field="*{fundAmount}">
					<span class="errors" style="display: none">에러출력</span>
				</div>
				
				<div class="int int_content">
					<label for="content">미지정 펀드 내용작성</label>
					<textarea class="content" id="summernote" th:field="*{content}" autocomplete="off"></textarea>
					<div class="errorList" style="display: none"></div>
					<span class="errors" style="display: none">에러출력</span>
				</div>
				
				<!-- 파일 업로드 -->
				<div class="int_file">
					<input type="file" multiple="multiple" name="file" />
				</div>
				<!-- //파일 업로드 -->
				
				<div>
					<button type="submit">등록하기</button>
				</div>
			</form>
			
		</div>
    </section>
    

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
	<script src=" https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.18/lang/summernote-ko-KR.min.js"></script>
	
	
	<script>
		// 유효성 검사
		var categorieName = document.querySelector('#categorieName'); 
		var categorieName = document.querySelector('#subject');
		var categorieName = document.querySelector('#place');
		var categorieName = document.querySelector('#startDateTime');
		var categorieName = document.querySelector('#fundDuration');
		var categorieName = document.querySelector('#runtime');
		var categorieName = document.querySelector('#minFund');
		var categorieName = document.querySelector('#fundAmount');
		var categorieName = document.querySelector('#summernote');
		
		var errors = document.querySelectorAll('.errors');
		
		categorieName.addEventListener('focusout',checkCategorieName);
		subject.addEventListener('focusout',checkSubject);
		place.addEventListener('focusout',checkPlace);
		startDateTime.addEventListener('focusout',checkStartDateTime);
		fundDuration.addEventListener('focusout',checkFundDuration);
		runtime.addEventListener('focusout',checkRuntime);
		minFund.addEventListener('focusout',checkMinFund);
		fundAmount.addEventListener('focusout',checkFundAmount);
		summernote.addEventListener('focusout',checkSummernote);
		
		function checkCategorieName(){
			if(categorieName.value === ""){
				errors[0].innerHTML='카테고리선택은 필수항목 입니다.'
				errors[0].style.display='block'
			}else{
				errors[0].style.display='none'
			}
		}
		
		function checkSubject(){
			if(categorieName.value === ""){
				errors[1].innerHTML='제목은 필수항목 입니다.'
				errors[1].style.display='block'
			}else{
				errors[1].style.display='none'
			}
		}
		
		function checkPlace(){
			if(categorieName.value === ""){
				errors[2].innerHTML='장소는 필수항목 입니다.'
				errors[2].style.display='block'
			}else{
				errors[2].style.display='none'
			}
		}
		
		function checkStartDateTime(){
			if(categorieName.value === ""){
				errors[3].innerHTML='공연 시작 일자는 필수항목 입니다.'
				errors[3].style.display='block'
			}else{
				errors[3].style.display='none'
			}
		}
		
		function checkFundDuration(){
			if(categorieName.value === ""){
				errors[4].innerHTML='펀딩 기간은 필수항목 입니다.'
				errors[4].style.display='block'
			}else{
				errors[4].style.display='none'
			}
		}
		
		function checkRuntime(){
			if(categorieName.value === ""){
				errors[5].innerHTML='공연 시간은 필수항목 입니다.'
				errors[5].style.display='block'
			}else{
				errors[5].style.display='none'
			}
		}
		
		function checkRuntime(){
			if(categorieName.value === ""){
				errors[6].innerHTML='공연 시간은 필수항목 입니다.'
				errors[6].style.display='block'
			}else{
				errors[6].style.display='none'
			}
		}
		
		
	</script>
	
	
	
	<script>
	
		// 썸머노트 부분
		$(document).ready(function() {
			$('#summernote').summernote({
				height: 300,
				width: 600,
				lang: "ko-KR",
				toolbar: [
					    // [groupName, [list of button]]
				    ['fontname', ['fontname']],
				    ['fontsize', ['fontsize']],
				    ['style', ['bold', 'italic', 'underline','strikethrough', 'clear']],
				    ['color', ['forecolor','color']],
				    ['table', ['table']],
				    ['para', ['ul', 'ol', 'paragraph']],
				    ['height', ['height']],
				    ['insert',['picture','link','video']],
				    ['view', ['fullscreen', 'help']]
				  ],
				fontNames: ['Arial', 'Arial Black', 'Comic Sans MS', 'Courier New','맑은 고딕','궁서','굴림체','굴림','돋움체','바탕체'],
				fontSizes: ['8','9','10','11','12','14','16','18','20','22','24','28','30','36','50','72']
				,callbacks: {	
					onImageUpload : function(files) {
						uploadSummernoteImageFile(files[0],this);
					}	
				}
			})		
		})
			
		// 썸머노트 이미지 업로드
		function uploadSummernoteImageFile(file, editor) {
			var token = $("meta[name='_csrf']").attr("content");
			var header = $("meta[name='_csrf_header']").attr("content");
				
			data = new FormData();
			data.append("file", file);
			$.ajax({
				data : data,
				type : "POST",
				url : "/file/summernote/file",
				contentType : false,
				processData : false,
				beforeSend : function(xhr){
					xhr.setRequestHeader(header, token);
				},
				success : function(data) {
		            //항상 업로드된 파일의 url이 있어야 한다.
					$(editor).summernote('editor.insertImage', data);
				}
			});
		}
	</script>
    
</body>
</html>
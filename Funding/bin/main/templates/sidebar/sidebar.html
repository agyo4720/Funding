
<meta name="_csrf" th:content="${_csrf.token}"/>
<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
<link rel="stylesheet" href="css/sidebar/sidebar.css">

<div class="sidebar">
	<div sec:authorize="isAuthenticated()">
		<input hidden class="user" th:value="${#authentication.getPrincipal().getUsername()}"/>
	</div>

	<div class="sid_title">
		<h3>Sidebar</h3>
	</div>

	<hr/>

	<div class="sid_alert">
		<p>알림</p>
		<p class="alert"></p>
	</div>

	<hr/>

	<p>현재 펀딩중인 목록</p>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
	$(document).ready(function(){
		let user = $(".user").val()
		if(user != null){
			console.log('실행됨')
			
			let token = $("meta[name='_csrf']").attr("content");
			let header = $("meta[name='_csrf_header']").attr("content");
			
			$.ajax({
				url : '/alert/show'
				,data : "user=" + user
				,beforeSend : function(xhr){
					xhr.setRequestHeader(header, token);
				}
				,success : function(result){
					$.each(result, function(index, item){					
						$('.alert').append("<br><a href=\"" + item.url + "?alertId=" + item.alertId + "\"><div>" + item.username + 
								"님이 댓글을 달았습니다.</div>[" + item.content + "]</a></br>")
					})
				}
			})
			
		}
	})

</script>
</div>
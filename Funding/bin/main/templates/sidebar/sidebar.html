
<meta name="_csrf" th:content="${_csrf.token}"/>
<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
<link rel="stylesheet" href="css/sidebar/sidebar.css">

<div class="sidebar">
	<div sec:authorize="isAuthenticated()">
		<input hidden class="user" th:value="${#authentication.getPrincipal().getUsername()}"/>
	</div>

	<div>사이드바</div>
	<div>알림</div>
	<div class="alert"></div>

	<div>현재 펀딩중인 목록</div>
	<div class="fundList"></div>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
	$(document).ready(function(){
		let user = $(".user").val()
		if(user != null){
			console.log('ajax 실행됨')
			
			let token = $("meta[name='_csrf']").attr("content");
			let header = $("meta[name='_csrf_header']").attr("content");
			
			$.ajax({
				url : '/alert/show'
				,data : "user=" + user
				,beforeSend : function(xhr){
					xhr.setRequestHeader(header, token);
				}
				,success : function(result){
					$.each(result, function(index, item){					
						$('.alert').append("<br><a href=\"" + item.url + "?alertId=" + item.alertId + "\"><div>" + item.username + 
								"님이 댓글을 달았습니다.</div>[" + item.content + "]</a></br>")
					})
				}
			})
			
			$.ajax({
				url : '/show/fundList'
				,data : "user=" + user
				,beforeSend : function(xhr){
					xhr.setRequestHeader(header, token);
				}
				,success : function(result){
					$.each(result, function(index, item){					
						$('.fundList').append("<br><a href=\"" + item.url + "\"><div>" + item.fundName + 
								" 진행도 " + item.percent + "</div></a></br>")
					})
				}
			})
		}
	})

</script>
</div>
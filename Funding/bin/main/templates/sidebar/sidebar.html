
<meta name="_csrf" th:content="${_csrf.token}"/>
<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
<link rel="stylesheet" href="css/sidebar/sidebar.css">

<div class="sidebarbtn">
	<h1>>></h1>
</div>
<div class="sidebar" sec:authorize="hasRole('ROLE_USER')">
	<div sec:authorize="isAuthenticated()">
		<input hidden class="user" th:value="${#authentication.getPrincipal().getUsername()}"/>
	</div>

	<h4>Sidebar</h4>

	<hr/>
	
	<h4>알림</h4>
	<div class="alert"></div>

	<hr/>

	<h4>현재 펀딩중인 목록</h4>
	<div class="fundList"></div>

<!--  유저일떄 화면    -->


<div class="sidebar" sec:authorize="hasRole('ROLE_ARTIST')">
	<div sec:authorize="isAuthenticated()">
		<input hidden class="artist" th:value="${#authentication.getPrincipal().getUsername()}"/>
	</div>

	<h4>Sidebar</h4>
	
	<h4>현재 신청한 펀딩목록</h4>
	<div class="fundList2"></div>
	
	
</div>




<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>

	$(document).ready(function(){
		let user = $(".user").val()
		if(user != null){
			console.log('ajax 실행됨')
			
			let token = $("meta[name='_csrf']").attr("content");
			let header = $("meta[name='_csrf_header']").attr("content");
			//알림 불러오는 ajax
			$.ajax({
				url : '/alert/show'
				,data : "user=" + user
				,beforeSend : function(xhr){
					xhr.setRequestHeader(header, token);
				}
				,success : function(result){
					$.each(result, function(index, item){	
						if(item.type == "댓글"){
							$('.alert').append("<a href=\"" + item.url + "?alertId=" + 
								item.alertId + "\"><div>" + item.username + 
								"님이 댓글을 달았습니다.</div>[" + item.content + "]</a>")
								
						}else if(item.type == "마감"){
							$('.alert').append("<a href=\"" + item.url + "?alertId=" + 
									item.alertId + "\"><div>[" + item.content +
									"]</div></a>")
						}
					})
				}
			})
			
			//현재 펀딩목록 불러오는 ajax
			$.ajax({
				url : '/show/fundList'
				,data : "user=" + user
				,beforeSend : function(xhr){
					xhr.setRequestHeader(header, token);
				}
				,success : function(result){
					$.each(result, function(index, item){					
						$('.fundList').append("<a href=\"" + item.url + "\"><div><br>" + item.status + "</br>" + 
								item.fundName + " 진행도 " + item.percent + "</div></a>")
					})
				}
			})
		}
	})
	
	//사이드바 액션
	$(document).ready(function(){
		
		$(".sidebarbtn").click(function(){
			if($(".sidebar").hasClass('active') == true){
				$(".sidebar").removeClass('active')
				$(".sidebarbtn").removeClass('active')
				$(".sidebarbtn h1").html(">>")
			}else{
				$(".sidebar").addClass('active')
				$(".sidebarbtn").addClass('active')
				$(".sidebarbtn h1").html("<<")
			}
		})
	})
</script>

